!function(e){var o=function(o){var r=this;return this.deferred=new e.Deferred,this.get_cookie=function(e){for(var o=e+"=",r=document.cookie.split(";"),t=0;t<r.length;t++){for(var i=r[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(o))return i.substring(o.length,i.length)}return null},this.create_cookie=function(e,o,t){if(t){var i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3);var s="; expires="+i.toGMTString()}else var s="";var n=r.popover_data&&r.popover_data.popover_id?e+"_"+r.popover_data.popover_id:e;document.cookie=n+"="+o+s+"; path=/"},this.remove_message_box_forever=function(){var e=r.popover_data.expiry||365;return r.remove_message_box(),r.create_cookie("popover_never_view","hidealways",e),!1},this.remove_message_box=function(){var o=r.popover_data.multi_open?"hide":"remove";return e("#darkbackground")[o](),e(r.popover_name)[o](),e(document).trigger("popover-closed"),!1},this.set_popup_size=function(){var o=r.popover_data,t=e("#message"),i=e(window),s=e(r.popover_name);(o.usejs&&"yes"===o.usejs||o.size&&o.size.usejs)&&(s.is(":visible")||((o.usejs&&"yes"===o.usejs||o.position&&o.position.usejs)&&s.css({top:i.height()}),s.show(),t=e("#message")),s.width(t.width()).height(t.height())),(o.usejs&&"yes"===o.usejs||o.position&&o.position.usejs)&&(s.is(":visible")||(s.css({top:i.height()}),s.show(),t=e("#message")),s.css({top:(e(window).height()-t.height())/2,left:(e(window).width()-t.width())/2})),s.is(":visible")||s.show()},this.set_up_message_box=function(){var o=r.popover_data;r.popover_name="#"+o.name,r.set_popup_size(o),e(window).off("resize.popover").on("resize.popover",function(){r.set_popup_size(o)}),e(r.popover_name).css("visibility","visible"),e("#darkbackground").css("visibility","visible"),e("#clearforever").off("click",r.remove_message_box_forever).on("click",r.remove_message_box_forever),r.popover_data&&r.popover_data.close_hide?e("#closebox").off("click",r.remove_message_box_forever).on("click",r.remove_message_box_forever):e("#closebox").off("click",r.remove_message_box).on("click",r.remove_message_box),e("#message").hover(function(){e(".claimbutton").removeClass("hide")},function(){e(".claimbutton").addClass("hide")}),e(document).trigger("popover-displayed",[r.popover_data,r])},this.load_message_box=function(){var o=r.popover_data;return""===o.html?!1:(e('<style type="text/css">'+o.style+"</style>").appendTo("head"),e(o.html).appendTo("body"),e("#"+o.name).css("visibility","hidden"),e("#darkbackground").css("visibility","hidden"),void 0)},this.on_success=function(e){r.popover_data=e,"nopoover"!==e.name&&r.load_message_box()},this.async_load_popover=function(){var t=window.location,i=document.referrer;return"undefined"==typeof force_popover&&(force_popover=0),e.ajax({url:o.endpoint,dataType:"jsonp",jsonpCallback:"po_a",data:{popoverajaxaction:o.action,action:o.action,thefrom:t.toString(),thereferrer:i.toString(),active_popover:force_popover.toString()},success:function(e){r.on_success(e)}})},this.init=function(){var t=new e.Deferred;return r.deferred.done(r.show),t.done(function(){e(document).trigger("popover-init",[r.deferred,r.popover_data]),setTimeout(function(){return r.popover_name="#"+r.popover_data.name,e(r.popover_name).hide(),r.popover_data.wait_for_event?!1:("pending"===r.deferred.state()&&r.deferred.resolve(),void 0)},500)}),o.popover?(r.popover_data=o.popover,t.resolve()):r.async_load_popover().done(function(){t.resolve()}),t},this.reinit=function(){r.deferred=new e.Deferred,r.deferred.done(r.show),e(document).trigger("popover-init",[r.deferred,r.popover_data]),setTimeout(function(){return r.popover_name="#"+r.popover_data.name,e(r.popover_name).hide(),r.popover_data.wait_for_event?!1:("pending"===r.deferred.state()&&r.deferred.resolve(),void 0)},500)},this.show=function(){window.setTimeout(function(){r.set_up_message_box(),r.popover_data.multi_open&&e(document).on("popover-closed",r.reinit)},r.popover_data.delay)},{init:this.init}};e(function(){var e=new o(_popover_data);e.init()})}(jQuery);